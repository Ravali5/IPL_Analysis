<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- India State Map  -->
    <title>India Map</title>

    <!--  Scripts  -->
    <script src="https://d3js.org/d3.v4.min.js"></script>"
    <script type="text/javascript" src="d3.geo.min.js"></script>

    <!--  Styles  -->  
    <link type="text/css" rel="stylesheet" href="zcolorbrewer.css"/>
    <style type="text/css">
    svg {
      background: #eee;
      }
      
    #india {
      fill: #FFFFFF;
      opacity: .8;
      stroke: #000000;
      stroke-width: 1;
      }
    </style>
  </head>
  
<body>
  <div id="chart" style="float:left;"></div>
  <div id="pie" style="float:right;"></div>
  <script type="text/javascript">
    var w = 600;
    var h = 600;
    var proj = d3.geo.mercator();
    var path = d3.geo.path().projection(proj);
    var t = proj.translate(); // the projection's default translation
    var s = proj.scale() // the projection's default scale

    var map = d3.select("#chart").append("svg:svg")
        .attr("width", w)
        .attr("height", h)
//        .call(d3.behavior.zoom().on("zoom", redraw))
        .call(initialize);

    var india = map.append("svg:g")
        .attr("id", "india");

    d3.json("states.json", function (json) {
      var units=india.selectAll("path")
                      .data(json.features)
                      .enter().append("path")               
                      .attr("d", path)
                      .style("fill",function(d){ return d["color"];})
                      .on("mouseover", function(d) {
                        d3.select(this)
                          .style("fill","#FF4500")
                         console.log(d["id"])
                      });

       /*  var c = d3.scaleOrdinal(d3.schemeCategory20);
         console.log(c)
          units
          .style("fill", function(d,i){ return c(i); })
          .style("opacity", ".6");*/
    });

    function initialize() {
      proj.scale(6700);
      proj.translate([-1240, 720]);
    }


     var width = 550
            height = 450
            margin = 40

  

        // The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
        var radius = Math.min(width, height) / 2 - margin

        // append the svg object to the div called 'my_dataviz'
        var svg = d3.select("#pie")
          .append("svg")
            .attr("width", width)
            .attr("height", height)
          .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        // Create dummy data
        //var data = {a: 9, b: 20, c:30, d:8, e:12}
        d3.csv("Votes.csv",function(error , data_pie) {


        // set the color scale

        // Compute the position of each group on the pie:
        var pie = d3.pie()
          .value(function(d) {return d.value['Likes ( In Millions )']; })
        var data_ready = pie(d3.entries(data_pie))
        console.log(data_pie[1]['color'])

        // Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.
        var arc=d3.arc()
            .innerRadius(0)
            .outerRadius(radius)

        svg
          .selectAll('whatever')
          .data(data_ready)
          .enter()
          .append('path')
          .attr('d', arc)
          .style('fill', function(d,i){ if (i<=7){ return data_pie[i]['color']; }})
          .attr("stroke", "black")
          .style("stroke-width", "0px")
          .style("opacity", 0.7)


          svg
          .selectAll('whatever')
          .data(data_ready)
          .enter()
          .append('image')
          .attr('d', d3.arc()
            .innerRadius(0)
            .outerRadius(radius)
          )
          .attr("transform", function(d) {                    //set the label's origin to the center of the arc
                //we have to make sure to set these before calling arc.centroid
                var c = arc.centroid(d),
            x = c[0],
            y = c[1],
            // pythagorean theorem for hypotenuse
            h = Math.sqrt(x*x + y*y);
           return "translate(" + (x/h * radius-10) +  ',' +
           (y/h * radius-10) +  ")"; })
          .attr("x","-40")
          .attr("y","-40")
          .attr('width', 80)
          .attr('height', 80)   
          .attr("xlink:href", "CSK.png")
          .text(function(d, i) { if (i<=7){ return data_pie[i]['Team']; }}); 

         /* svg
          .selectAll('whatever')
          .data(data_ready)
          .enter()
          .append('text')
          .attr('d', d3.arc()
            .innerRadius(0)
            .outerRadius(radius)
          )
          .attr("transform", function(d) {                    //set the label's origin to the center of the arc
                //we have to make sure to set these before calling arc.centroid
                var c = arc.centroid(d),
            x = c[0],
            y = c[1],
            // pythagorean theorem for hypotenuse
            h = Math.sqrt(x*x + y*y);
           return "translate(" + (x/h * radius-1) +  ',' +
           (y/h * radius-3) +  ")"; })
          .attr("dy", ".35em")
          .attr("text-anchor", function(d) {
        // are we past the center?
             return (d.endAngle + d.startAngle)/2 > Math.PI ?
            "end" : "start";
    })  
          .text(function(d, i) { if (i<=7){ return data_pie[i]['Team']; }});*/
          


});

/*   
   // This section should allow for zoom & pan.

   function redraw() {
      // d3.event.translate stores the current translation from the parent SVG element
      // t stores the projection's default translation
      // adding the x and y vales in each array to yields the projection's new translation
      var tx = t[0] * d3.event.scale + d3.event.translate[0];
      var ty = t[1] * d3.event.scale + d3.event.translate[1];
      proj.translate([tx, ty]);

      // determine the projection's new scale and redraw the map:
      proj.scale(s * d3.event.scale); 
      india.selectAll("path").attr("d", path);
    }


     // This section should color each state.

var states = svg.append("g")
    .attr("id", "states")
    .attr("class", "Blues");

    // load the GDP data
    d3.json("wealth.json", function(json) {
      data = json;
      states.selectAll("path")
        .attr("class", quantize);
    });
    
    function quantize(d) {
      return "q" + Math.min(8, ~~(data[d.id] * 9 / 12)) + "-9";
    }
*/
  </script>
</body>
</html>